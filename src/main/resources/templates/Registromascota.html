<!DOCTYPE html>
<html lang="en">
    <head>
        <title>REGISTRAR MASCOTA</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://bootswatch.com/5/sketchy/bootstrap.min.css">
        <link rel="stylesheet" href="css/all.min.css" >
        <link rel="icon" href="img/iconohuella.png">
         <!-- Menu -->
         
    </head>
       
       <!-- estilo  -->
    <style>

      body {
        font-family: "Segoe UI", sans-serif;
        font-size:100%;
        margin:0;
        padding:0;
      }
    
    
     form#formulario{
        display: block;
        color: black;
        position:absolute;
        text-align: justify;
        top: 20%;
        left: 60%;
        
     }
     * {box-sizing: border-box;font-family:arial;}
    .hide {display:none;}
    .right {text-align:right;}
    .error {border:1px solid Red;}
 
     .nombre {width:100%}
     .formulario {text-align:center;width:400px;border:1px solid #eee;padding:10px;}
     .formulario label,.formulario label~input {
        width: 50%;
        display: inline-block;
     }
     .formulario label {text-align:right;padding-right:20px;}
     .formulario>div {margin-top:10px;overflow:hidden;}
     .boton {
        border:none;
        color:white;
        padding:10px 20px;
     }
     .agregar {
        background-color:green;
     }
     .enviar {
        background-color:rgb(128, 0, 117);
     }
 
     #listado {
        border:1px solid #eee;
        margin-top:20px;
        top:20%;
        left:60%;
        width:400px;
     }
     #listado th {background-color:#eee;padding:5px 10px;}
     #listado img {
        cursor:pointer;
     }
     img{
        width: 25px;
        height: 25px;
     }
    </style> 
    
      <!-- cuerpo -->

    <body background="img/gatoregistro.png">
  
           <form id="formulario" action="Registroexitoso.html" method="post" >
             <legend>REGISTRÁ A TU MASCOTA</legend>
                 <div class="mb-3">
                     <label>Nombre: </label>
                     <input type="text" placeholder="Nombre de tu mascota" name="nombre">
                 </div>
                 <div class="mb-3">
                     <label>Edad: </label>
                     <input type="number" placeholder="Edad" name="edad" min="1" max="100">
                 </div>
                 <div class="mb-3">
                     <label>Mascota: </label>
                     <input type="text" placeholder="Perro/Gato" name="mascota">
                 </div>
                 <div class="mb-3">
                     <label>Carnet:  </label>
                     <input type="text" placeholder="Si/No" name="carnet">
                 </div>
                 <br><br><input type="submit" value="Agregar" class="boton agregar"> <input type="button" value="Enviar" class='boton enviar'>
                
              <table id="listado" class="hide" >
                  <thead class="bg-white border-black">
                     <th>Nombre</th>
                     <th>Edad</th>
                     <th>Mascota</th>
                     <th>Carnet</th>  
                  </thead>
                  <tbody>

                  </tbody>
             </table>

            </form>

            <script>
                // Evento que se ejecuta al pulsar el botón agregar
                document.querySelector("input[type=submit]").addEventListener("click",function(e){
                    // cancelamos el evento
                    e.preventDefault();
                 
                    const nombre=document.querySelector("input[name=nombre]");
                    const edad=document.querySelector("input[name=edad]");
                    const mascota=document.querySelector("input[name=mascota]");
                    const carnet=document.querySelector("input[name=carnet]");
                 
                    // mostramos un error si no ha recibido el nombre
                    if (!nombre.value) {
                        nombre.classList.add("error");
                        return;
                    }
                    nombre.classList.remove("error");
                 
                    // mostramos un error si no ha recibido una edad
                    if (isNaN(parseInt(edad.value)) || parseInt(edad.value)<=0) {
                        edad.classList.add("error");
                        return;
                    }
                    edad.classList.remove("error");

                    if (!mascota.value) {
                        mascota.classList.add("error");
                        return;
                    }
                    mascota.classList.remove("error");

                    if (!carnet.value) {
                        carnet.classList.add("error");
                        return;
                    }
                    carnet.classList.remove("error");
                 
                    agregarFila(nombre.value, edad.value, mascota.value, carnet.value);
                    agregarInput(nombre.value, edad.value, mascota.value, carnet.value);
                 
                    /*limpiamos los valores del input*/
                    carnet.value="";
                    mascota.value="";
                    edad.value="";
                    nombre.value="";
                    nombre.focus();
                 
                });
                 
                // Evento que se ejecuta cuando se pulsa sobre el botón enviar
                document.querySelector(".enviar").addEventListener("click", function(e) {
                    this.closest("form").submit();
                })
                 
                /**
                 * Funcion para añadir los datos en la tabla
                 *
                 * 
                 */
                function agregarFila(nombre, edad, mascota, carnet) {
                    // añadimos  a la tabla crando el tr, td's y el botón para eliminarlo
                    const tr=document.createElement("tr");
                 
                    const tdNombre=document.createElement("td");
                    let txt=document.createTextNode(nombre);
                    tdNombre.appendChild(txt);
                    tdNombre.className="nombre";
                 
                    const tdEdad=document.createElement("td");
                    txt=document.createTextNode(edad);
                    tdEdad.appendChild(txt);
                    tdEdad.className="edad";

                    const tdMascota=document.createElement("td");
                     txt=document.createTextNode(mascota);
                    tdMascota.appendChild(txt);
                    tdMascota.className="mascota";

                    const tdCarnet=document.createElement("td");
                      txt=document.createTextNode(carnet);
                    tdCarnet.appendChild(txt);
                    tdCarnet.className="carnet";

                 
                    const tdRemove=document.createElement("td");
                    const buttonRemove=document.createElement("img");
                    buttonRemove.src="img/tachito.png";
                    buttonRemove.onclick=eliminarFila;
                    tdRemove.appendChild(buttonRemove);

    
                    tr.appendChild(tdNombre);
                    tr.appendChild(tdEdad);
                    tr.appendChild(tdMascota);
                    tr.appendChild(tdCarnet);
                    tr.appendChild(tdRemove);
                 
                    const tbody=document.getElementById("listado").querySelector("tbody").appendChild(tr);
                 
                    // eliminamos la clase que tiene oculta la tabla cando no hay ningun dato
                    document.getElementById("listado").classList.remove("hide");
                }
                 
                /**
                 * Funcion para eliminar el usuario de la tabla y llamar a la funcion
                 * para eliminar al usuario del input oculto
                 */
                function eliminarFila(e) {
                    const tr=this.closest("tr")
                    const nombre=tr.querySelector(".nombre").innerText;
                    const edad=tr.querySelector(".edad").innerText;
                    const mascota=tr.querySelector(".mascota").innerText;
                    const carnet=tr.querySelector(".carnet").innerText;
                 
                    eliminarInput(nombre, edad, mascota, carnet);
                    tr.remove();
                 
                    // Si no hay ningun elemento en la lista, escondemos la tabla
                    if (document.getElementById("listado").querySelector("tbody").querySelectorAll("tr").length==0) {
                        document.getElementById("listado").classList.add("hide");
                    }
                }
                 
                /**
                 * Funcion para crear un input oculto para cuando se envie el formulario
                 *
                 */
                function agregarInput(nombre, edad, mascota,carnet) {
                    const input=document.createElement("input");
                    input.type="hidden";
                    input.name="nombres[]";
                    input.value=nombre+"-"+edad+"-"+mascota+"-"+carnet;
                 
                    document.querySelector("form").appendChild(input);
                }
                 
                /**
                 * Funcion para eliminar el input oculto
                 *
                 *
                 */
                function eliminarInput(nombre, edad,mascota,carnet) {
                    const input=document.querySelector("input[type=hidden][value="+nombre+"-"+edad+"-"+mascota+"-"+carnet+"]");
                    input.remove();
                }
                </script>
    </body>     
</html>    